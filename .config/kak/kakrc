evaluate-commands %sh{
    cork init
    kak-lsp --kakoune -s $kak_session
}
set-option global lsp_cmd "kak-lsp -s %val{session} -vvv --log /tmp/kak-lsp.log"

# --------------------------------------------------
# PLUGINS

cork auto-pairs.kak "https://github.com/alexherbo2/auto-pairs.kak"

cork kak-harpoon "https://git.sr.ht/~raiguard/kak-harpoon" %{
    harpoon-add-bindings
}

cork kak-mirror "https://git.sr.ht/~raiguard/kak-mirror" %{
    map global normal "'" ': enter-user-mode -lock mirror<ret>' -docstring 'mirror lock'
}

cork kak-move-lines "https://git.sr.ht/~raiguard/kak-move-lines" %{
    map global normal â“™ ': move-lines-down %val{count}<ret>'
    map global normal <c-k> ': move-lines-up %val{count}<ret>'
}

cork kak-live-grep "https://git.sr.ht/~raiguard/kak-live-grep" %{
    map global user / ": live-grep<ret>" -docstring "live grep"
}

cork kak-rainbower "https://github.com/crizan/kak-rainbower" %{
    set-option global rainbow_mode 0
    set-option global rainbow_check_templates Y
}

cork kakoune-fandt "https://github.com/listentolist/kakoune-fandt" %{
    require-module fandt
}

cork kakoune-focus "https://github.com/caksoylar/kakoune-focus" %{
    map global user <space> ': focus-toggle<ret>' -docstring "toggle selections focus"
}

cork kakoune-gdb "https://github.com/occivink/kakoune-gdb"

cork kakoune-grep-write "https://github.com/JacobTravers/kakoune-grep-write" %{
    hook global BufCreate \*grep\* %{
        alias buffer w grep-write
    }
}

cork kakoune-snippets "https://github.com/CharlesGueunet/kakoune-snippets"

cork kakoune-sort-selections "https://github.com/occivink/kakoune-sort-selections"

cork kakoune-state-save "https://gitlab.com/Screwtapello/kakoune-state-save"

cork local-kakrc "https://github.com/dgmulf/local-kakrc" %{
    set-option global source_local_kakrc true
}

cork mark.kak "https://github.com/alexherbo2/mark.kak"

cork pmanage.kak "https://github.com/andreyorst/pmanage.kak"

cork smarttab.kak "https://github.com/andreyorst/smarttab.kak"

# --------------------------------------------------
# GENERAL

# Color scheme
colorscheme one-darker-16
# Mark.kak faces
set-face global MarkedPrimaryCursor black,magenta+f
set-face global MarkedPrimarySelection black,magenta+f
set-face global MarkedSecondaryCursor MarkedPrimaryCursor
set-face global MarkedSecondarySelection MarkedPrimarySelection
# kak-live-grep faces
set-face global LiveGrepMatch +u
# FandT faces
hook global ModeChange push:.*:user.fandt %{
    set-face window PrimarySelection black,yellow
    set-face window SecondarySelection black,yellow
}
hook global ModeChange pop:user.fandt:.* %{
    unset-face window PrimarySelection
    unset-face window SecondarySelection
}
# Custom faces
set-face global Ruler ,black
# Highlighters
add-highlighter global/ number-lines -relative -separator " " -hlcursor
add-highlighter global/ show-matching

# UI settings
set-option global ui_options terminal_assistant=off terminal_set_title=false
set-option global startup_info_version 10000000000000 # Don't show changelog
set-option global scrolloff 5,5

# Auto-reload please
set-option global autoreload yes

# Use ripgrep instead of grep
set-option global grepcmd 'rg -Hn --no-heading --sort path --vimgrep'

# --------------------------------------------------
# OTHERS

source "%val{config}/commands.kak"
source "%val{config}/hooks.kak"
source "%val{config}/keybindings.kak"
source "%val{config}/lsp.kak"
source "%val{config}/replace-mode.kak"
source "%val{config}/status-line.kak"
source "%val{config}/todo.kak"

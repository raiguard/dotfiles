evaluate-commands %sh{
    cork init
    kks init
    kak-lsp --kakoune -s $kak_session
}

# ========================================
# PLUGINS

cork kak-ansi "https://github.com/eraserhd/kak-ansi"

cork kak-focus "https://github.com/caksoylar/kakoune-focus" %{
    map global user <space> ': focus-toggle<ret>' -docstring "toggle selections focus"
}

cork kak-rainbower "https://github.com/crizan/kak-rainbower" %{
    set-option global rainbow_mode 0
    set-option global rainbow_check_templates Y
}

cork kakboard "https://github.com/lePerdu/kakboard"

cork kakoune-buffer-switcher "https://github.com/occivink/kakoune-buffer-switcher" %{
    face global BufferSwitcherCurrent green
    map global normal <backspace> ": buffer-switcher<ret>"
}

cork kakoune-fandt "https://github.com/listentolist/kakoune-fandt" %{
    require-module fandt
}

cork kakoune-grep-write "https://github.com/JacobTravers/kakoune-grep-write" %{
    hook global BufCreate \*grep\* %{
        alias buffer w grep-write
    }
}

cork kakoune-mirror "https://github.com/delapouite/kakoune-mirror" %{
    map global normal "'" ": enter-user-mode -lock mirror<ret>"
}

cork kakoune-sort-selections "https://github.com/occivink/kakoune-sort-selections"

cork kakoune-state-save "https://gitlab.com/Screwtapello/kakoune-state-save"

cork kakoune-sudo-write "https://github.com/occivink/kakoune-sudo-write"

cork kakoune-text-objects "https://github.com/delapouite/kakoune-text-objects" %{
    map global user "o" ": select-objects<ret>" -docstring "select objects"
}

cork local-kakrc "https://github.com/dgmulf/local-kakrc" %{
    set-option global source_local_kakrc true
}

cork luar "https://github.com/gustavo-hms/luar" %{
    require-module luar

    cork harpoon.kak "https://github.com/raiguard/harpoon.kak" %{
        harpoon-add-bindings
    }
}

cork mark.kak "https://github.com/alexherbo2/mark.kak"

cork rainmeter.kak "https://github.com/raiguard/rainmeter.kak"

cork smarttab.kak "https://github.com/andreyorst/smarttab.kak"

# ========================================
# GENERAL

# Color scheme
colorscheme one-darker
one-enable-fancy-underlines

# Highlighters
add-highlighter global/ number-lines -relative -hlcursor -separator " ‚ñè " -min-digits 4
add-highlighter global/ show-matching
add-highlighter global/trailing-whitespaces regex "(\h+)$" "1:default,rgba:%opt{darkred}%opt{selectionalpha}"

# RIP clippy and titles
set-option global ui_options terminal_assistant=off terminal_set_title=false

# Keep cursor away from the edges
set-option global scrolloff 5,5

# Auto-reload please!
set-option global autoreload yes

# Use ripgrep instead of grep
set-option global grepcmd 'rg -Hn --no-heading --sort path --vimgrep'

# Don't show changelog
set-option global startup_info_version 10000000000000

# mark.kak faces - have to be defined after the colorscheme invokation
face global MarkedPrimaryCursor "default,rgba:%opt{magenta}%opt{cursoralpha}"
face global MarkedPrimarySelection "default,rgba:%opt{magenta}%opt{selectionalpha}"
face global MarkedSecondaryCursor "default,rgba:%opt{magenta}%opt{cursoralpha}"
face global MarkedSecondarySelection "default,rgba:%opt{magenta}%opt{selectionalpha}"

# Make kks work as a stand-in for kcr
alias global connect kks-connect

# ========================================
# EXTERNAL CONFIGURATION

define-command load -params 2 -hidden %{
    try %{ source "%val{config}/%arg{1}/%arg{2}.kak" }
}

# TOOLS

load tool buffer
load tool kitty
load tool log-scroll
load tool loli
load tool lsp
# load tool modeline
load tool status-bar
load tool move-lines
load tool nnn
load tool replace-mode
load tool todo

# GENERAL CONFIGURATION

load config commands
load config modes
load config hooks
load config keybindings

# FILETYPES

load filetype cpp
load filetype factorio-changelog
load filetype json
load filetype kak
load filetype latex
load filetype lua
load filetype python
load filetype rainmeter
load filetype rust
load filetype sh
load filetype toml
load filetype ts
load filetype yaml

source "~/dev/projects/personal/loli.kak/rc/loli.kak"
source "~/dev/projects/personal/loli.kak/rc/debug.kak"
loli-add-aliases

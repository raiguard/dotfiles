#!/usr/bin/python

import glob
import in_place
import subprocess

# Quote sources
for file in glob.glob("**/*.cfg", recursive=True):
    with in_place.InPlace(file) as file:
        for line in file:
            components = line.split("=", maxsplit=1)
            if len(components) == 2:
                file.write(components[0] + '="' +
                           components[1].strip() + '"\n')
            else:
                file.write(components[0])

subprocess.run(["crowdin", "push", "sources"])
subprocess.run(["crowdin", "pull"])

# Unquote translations
for file in glob.glob("**/*.cfg", recursive=True):
    with in_place.InPlace(file) as file:
        for line in file:
            components = line.split("=", maxsplit=1)
            if len(components) == 2:
                file.write(components[0] + '=' +
                           components[1].strip().strip('"') + '\n')
            else:
                file.write(line)

#!/bin/sh

dir="$PWD"
subdir=$(basename $PWD | sed 's/Factorio-//')
if [ -d "src" ]; then
    dir="$dir/src"
elif [ -d $subdir ]; then
    dir="$dir/$subdir"
fi

if [ ! -f "$dir/info.json" ]; then
    echo "Invalid mod folder structure"
    exit
fi

modname=$(awk '/"name":/ { gsub(/("|,)/, ""); print $2 }' $dir/info.json)
if [ -z "$modname" ]; then
    echo "Could not extract mod name"
    exit
fi

destination="$HOME/dev/factorio/linked/mods/$modname"

if [ -L "$destination" ]; then
    if [ "$1" == "--force" ]; then
        rm $destination
        echo "Forcibly removed existing mod"
    else
        echo "Mod already exists in the mods folder"
        exit
    fi
fi

ln -s $dir $destination
echo "Created symbolic link at $destination"

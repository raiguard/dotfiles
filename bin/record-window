#!/bin/sh

getTargetDirectory() {
  test -f ${XDG_CONFIG_HOME:-~/.config}/user-dirs.dirs && \
    . ${XDG_CONFIG_HOME:-~/.config}/user-dirs.dirs

  echo ${XDG_VIDEOS_DIR:-$HOME}
}

GEOM=$(swaymsg -t get_tree | jq -r '.. | select(.pid? and .visible?) | .rect | "\(.x),\(.y) \(.width)x\(.height)"' | slurp)
FILE=${3:-$(getTargetDirectory)/$(date -Ins).mp4}
wf-recorder -g "$GEOM" -f "$FILE" -F fps=30

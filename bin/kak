#!/bin/sh

kak=/usr/local/bin/kak

# Only do stuff if invoked with 'kak <filename>'
case "$1" in
    -*)
        $kak $@
        exit
    ;;
esac

session="default"

basedir=$(git rev-parse --show-toplevel 2> /dev/null)
if [ -n "$basedir" ]; then
    session=$(basename "$basedir")
fi

sessions=$($kak -l)
if $(echo "$sessions" | grep -q "(dead)"); then
    echo "Clearing dead sessions"
    $kak -clear
    sessions=$($kak -l)
fi
if $(echo "$sessions" | grep -q "\b$session\b"); then
    $kak -c $session $@
else
    $kak -s $session $@
fi
